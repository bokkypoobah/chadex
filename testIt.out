

  Dexz

      beforeEach
        --- Setup Tokens and Dexz Contracts. Assuming gasPrice: 40.0 gwei, ethUsd: 2000.0 ---
        > Deployed Token0 - gasUsed: 510271 ~ ETH 0.02041084 ~ USD 40
          + Token0:0x5FbD 1.0 Transfer(from: null:0x0000, to: deployer:0xf39F, tokens: 400.0)
        Token0 deployed
        > Deployed Token1 - gasUsed: 510271 ~ ETH 0.02041084 ~ USD 40
          + Token1:0xe7f1 2.0 Transfer(from: null:0x0000, to: deployer:0xf39F, tokens: 400.0)
        Token1 deployed
        > Deployed WETH - gasUsed: 527153 ~ ETH 0.02108612 ~ USD 42
        WETH deployed
        > Deployed Dexz - gasUsed: 3272214 ~ ETH 0.13088856 ~ USD 261
        Dexz deployed
        > Transfer Token0 - gasUsed: 51226 ~ ETH 0.00204904 ~ USD 4
          + Token0:0x5FbD 5.0 Transfer(from: deployer:0xf39F, to: user0:0x7099, tokens: 100.0)
        > Transfer Token0 - gasUsed: 51214 ~ ETH 0.00204856 ~ USD 4
          + Token0:0x5FbD 6.0 Transfer(from: deployer:0xf39F, to: user1:0x3C44, tokens: 100.0)
        > Transfer Token0 - gasUsed: 51226 ~ ETH 0.00204904 ~ USD 4
          + Token0:0x5FbD 7.0 Transfer(from: deployer:0xf39F, to: user2:0x90F7, tokens: 100.0)
        > Transfer Token0 - gasUsed: 46426 ~ ETH 0.00185704 ~ USD 3
          + Token0:0x5FbD 8.0 Transfer(from: deployer:0xf39F, to: user3:0x15d3, tokens: 100.0)
        Tokens transferred
        > Transfer Token1 - gasUsed: 51226 ~ ETH 0.00204904 ~ USD 4
          + Token1:0xe7f1 9.0 Transfer(from: deployer:0xf39F, to: user0:0x7099, tokens: 100.0)
        > Transfer Token1 - gasUsed: 51214 ~ ETH 0.00204856 ~ USD 4
          + Token1:0xe7f1 10.0 Transfer(from: deployer:0xf39F, to: user1:0x3C44, tokens: 100.0)
        > Transfer Token1 - gasUsed: 51226 ~ ETH 0.00204904 ~ USD 4
          + Token1:0xe7f1 11.0 Transfer(from: deployer:0xf39F, to: user2:0x90F7, tokens: 100.0)
        > Transfer Token1 - gasUsed: 46426 ~ ETH 0.00185704 ~ USD 3
          + Token1:0xe7f1 12.0 Transfer(from: deployer:0xf39F, to: user3:0x15d3, tokens: 100.0)
        > Send weth - gasUsed: 44744 ~ ETH 0.00178976 ~ USD 3
          + WETH:0x9fE4 13.0 Deposit(dst: user0:0x7099, wad: 100.0)
        > Send weth - gasUsed: 44744 ~ ETH 0.00178976 ~ USD 3
          + WETH:0x9fE4 14.0 Deposit(dst: user1:0x3C44, wad: 100.0)
        > Send weth - gasUsed: 44744 ~ ETH 0.00178976 ~ USD 3
          + WETH:0x9fE4 15.0 Deposit(dst: user2:0x90F7, wad: 100.0)
        > Send weth - gasUsed: 44744 ~ ETH 0.00178976 ~ USD 3
          + WETH:0x9fE4 16.0 Deposit(dst: user3:0x15d3, wad: 100.0)
        > user0->token0.approve(dexz, 100.0) - gasUsed: 45962 ~ ETH 0.00183848 ~ USD 3
          + Token0:0x5FbD 17.0 Approval(tokenOwner: user0:0x7099, spender: Dexz:0xCf7E, tokens: 100.0)
        > user0->token1.approve(dexz, 100.0) - gasUsed: 45962 ~ ETH 0.00183848 ~ USD 3
          + Token1:0xe7f1 18.0 Approval(tokenOwner: user0:0x7099, spender: Dexz:0xCf7E, tokens: 100.0)
        > user0->weth.approve(dexz, 100.0) - gasUsed: 45954 ~ ETH 0.00183816 ~ USD 3
          + WETH:0x9fE4 19.0 Approval(tokenOwner: user0:0x7099, spender: Dexz:0xCf7E, tokens: 100.0)
        > user1->token0.approve(dexz, 100.0) - gasUsed: 45962 ~ ETH 0.00183848 ~ USD 3
          + Token0:0x5FbD 20.0 Approval(tokenOwner: user1:0x3C44, spender: Dexz:0xCf7E, tokens: 100.0)
        > user1->token1.approve(dexz, 100.0) - gasUsed: 45962 ~ ETH 0.00183848 ~ USD 3
          + Token1:0xe7f1 21.0 Approval(tokenOwner: user1:0x3C44, spender: Dexz:0xCf7E, tokens: 100.0)
        > user1->weth.approve(dexz, 100.0) - gasUsed: 45954 ~ ETH 0.00183816 ~ USD 3
          + WETH:0x9fE4 22.0 Approval(tokenOwner: user1:0x3C44, spender: Dexz:0xCf7E, tokens: 100.0)
        > user2->token0.approve(dexz, 100.0) - gasUsed: 45962 ~ ETH 0.00183848 ~ USD 3
          + Token0:0x5FbD 23.0 Approval(tokenOwner: user2:0x90F7, spender: Dexz:0xCf7E, tokens: 100.0)
        > user2->token1.approve(dexz, 100.0) - gasUsed: 45962 ~ ETH 0.00183848 ~ USD 3
          + Token1:0xe7f1 24.0 Approval(tokenOwner: user2:0x90F7, spender: Dexz:0xCf7E, tokens: 100.0)
        > user2->weth.approve(dexz, 100.0) - gasUsed: 45954 ~ ETH 0.00183816 ~ USD 3
          + WETH:0x9fE4 25.0 Approval(tokenOwner: user2:0x90F7, spender: Dexz:0xCf7E, tokens: 100.0)
        > user3->token0.approve(dexz, 100.0) - gasUsed: 45962 ~ ETH 0.00183848 ~ USD 3
          + Token0:0x5FbD 26.0 Approval(tokenOwner: user3:0x15d3, spender: Dexz:0xCf7E, tokens: 100.0)
        > user3->token1.approve(dexz, 100.0) - gasUsed: 45962 ~ ETH 0.00183848 ~ USD 3
          + Token1:0xe7f1 27.0 Approval(tokenOwner: user3:0x15d3, spender: Dexz:0xCf7E, tokens: 100.0)
        > user3->weth.approve(dexz, 100.0) - gasUsed: 45954 ~ ETH 0.00183816 ~ USD 3
          + WETH:0x9fE4 28.0 Approval(tokenOwner: user3:0x15d3, spender: Dexz:0xCf7E, tokens: 100.0)

        --- Setup Completed. Dexz bytecode ~14929 ---
          Account                                   ETH                 TOK0[18]                 TOK1[18]                 WETH[18] Blah
          -------------------- ------------------------ ------------------------ ------------------------ ------------------------ ---------------------------------------------
          deployer:0xf39F       9999.991495909267008439                      0.0                      0.0                      0.0
          user0:0x7099          9899.999795896791789446                    100.0                    100.0                    100.0
          user1:0x3C44          9899.999801273823888472                    100.0                    100.0                    100.0
          user2:0x90F7          9899.999805091932994732                    100.0                    100.0                    100.0
          user3:0x15d3          9899.999807837994267926                    100.0                    100.0                    100.0
          Dexz:0xCf7E                               0.0                      0.0                      0.0                      0.0

          Dexz: Dexz:0xCf7E
      00. Test 00 - Happy Path - Specified Set
        > user0->dexz.trade(FillAnyAndAddOrder, SELL, token0, WETH, 0.69, expiry, baseTokens1, []) - gasUsed: 304449 ~ ETH 0.01217796 ~ USD 24
          + Dexz:0xCf7E 29.0 PairAdded(pairKey: 0x4c03...1e77, baseToken: Token0:0x5FbD, quoteToken: WETH:0x9fE4, baseDecimals: 18, quoteDecimals: 18, multiplier: 9, divisor: 0)
          + Dexz:0xCf7E 29.1 OrderAdded(pairKey: 0x4c03...1e77, key: 0x6e3a...42fb, maker: user0:0x7099, buySell: 1, price: 0.69, expiry: 1684909718, baseTokens: 1.0)
        > user1->dexz.trade(FillAnyAndAddOrder, SELL, token0, WETH, 0.69, expiry, baseTokens2, []) - gasUsed: 126888 ~ ETH 0.00507552 ~ USD 10
          + Dexz:0xCf7E 30.0 OrderAdded(pairKey: 0x4c03...1e77, key: 0xe5f3...5b56, maker: user1:0x3C44, buySell: 1, price: 0.69, expiry: 1684909718, baseTokens: 2.0)
        > user2->dexz.trade(FillAnyAndAddOrder, SELL, token0, WETH, 0.69, expiry, baseTokens3, []) - gasUsed: 126888 ~ ETH 0.00507552 ~ USD 10
          + Dexz:0xCf7E 31.0 OrderAdded(pairKey: 0x4c03...1e77, key: 0x9ed6...800a, maker: user2:0x90F7, buySell: 1, price: 0.69, expiry: 1684909718, baseTokens: 3.0)
        > user0->dexz.trade(FillAnyAndAddOrder, SELL, token0, WETH, 0.69012345, expiry, baseTokens1, []) - gasUsed: 173726 ~ ETH 0.00694904 ~ USD 13
          + Dexz:0xCf7E 32.0 OrderAdded(pairKey: 0x4c03...1e77, key: 0x45b3...0921, maker: user0:0x7099, buySell: 1, price: 0.69012345, expiry: 1684909718, baseTokens: 1.0)
        > user1->dexz.trade(FillAnyAndAddOrder, SELL, token0, WETH, 0.69012345, expiry, baseTokens2, []) - gasUsed: 129091 ~ ETH 0.00516364 ~ USD 10
          + Dexz:0xCf7E 33.0 OrderAdded(pairKey: 0x4c03...1e77, key: 0x18e9...9810, maker: user1:0x3C44, buySell: 1, price: 0.69012345, expiry: 1684909718, baseTokens: 2.0)
        > user2->dexz.trade(FillAnyAndAddOrder, SELL, token0, WETH, 0.69012345, expiry, baseTokens3, []) - gasUsed: 129091 ~ ETH 0.00516364 ~ USD 10
          + Dexz:0xCf7E 34.0 OrderAdded(pairKey: 0x4c03...1e77, key: 0xfaee...3357, maker: user2:0x90F7, buySell: 1, price: 0.69012345, expiry: 1684909718, baseTokens: 3.0)
        > user0->dexz.trade(FillAnyAndAddOrder, SELL, token0, WETH, 0.6902, expiry, baseTokens1, []) - gasUsed: 188403 ~ ETH 0.00753612 ~ USD 15
          + Dexz:0xCf7E 35.0 OrderAdded(pairKey: 0x4c03...1e77, key: 0x3c4b...4cd9, maker: user0:0x7099, buySell: 1, price: 0.6902, expiry: 1684909718, baseTokens: 1.0)
        > user1->dexz.trade(FillAnyAndAddOrder, SELL, token0, WETH, 0.6902, expiry, baseTokens2, []) - gasUsed: 129091 ~ ETH 0.00516364 ~ USD 10
          + Dexz:0xCf7E 36.0 OrderAdded(pairKey: 0x4c03...1e77, key: 0x9d56...f8ee, maker: user1:0x3C44, buySell: 1, price: 0.6902, expiry: 1684909718, baseTokens: 2.0)
        > user2->dexz.trade(FillAnyAndAddOrder, SELL, token0, WETH, 0.6902, expiry, baseTokens3, []) - gasUsed: 129091 ~ ETH 0.00516364 ~ USD 10
          + Dexz:0xCf7E 37.0 OrderAdded(pairKey: 0x4c03...1e77, key: 0xd089...08dc, maker: user2:0x90F7, buySell: 1, price: 0.6902, expiry: 1684909718, baseTokens: 3.0)

        --- After Adding Order(s) ---
          Account                                   ETH                 TOK0[18]                 TOK1[18]                 WETH[18] Blah
          -------------------- ------------------------ ------------------------ ------------------------ ------------------------ ---------------------------------------------
          deployer:0xf39F       9999.991495909267008439                      0.0                      0.0                      0.0
          user0:0x7099          9899.999118163916093468                    100.0                    100.0                    100.0
          user1:0x3C44          9899.999410947502333529                    100.0                    100.0                    100.0
          user2:0x90F7          9899.999415417042022057                    100.0                    100.0                    100.0
          user3:0x15d3          9899.999807837994267926                    100.0                    100.0                    100.0
          Dexz:0xCf7E                               0.0                      0.0                      0.0                      0.0

          Dexz: Dexz:0xCf7E
          ----- Pair 0x4c038ad6bfca2133ee6f20ac54377d10fb6f3756d2321ead7428e24817161e77 Token0:0x5FbD/WETH:0x9fE4 9 0 -----
              #    BUY Price OrderKey   Next       Maker         Expiry(s)   BaseTokens       Filled
            --- ------------ ---------- ---------- ------------ ---------- ------------ ------------

              #   SELL Price OrderKey   Next       Maker         Expiry(s)   BaseTokens       Filled
            --- ------------ ---------- ---------- ------------ ---------- ------------ ------------
              0         0.69 0x6e3ae2aa 0xe5f3d90d user0:0x7099      59.98          1.0          0.0
              1         0.69 0xe5f3d90d 0x9ed65da9 user1:0x3C44      59.98          2.0          0.0
              2         0.69 0x9ed65da9 0x00000000 user2:0x90F7      59.98          3.0          0.0
              3   0.69012345 0x45b36645 0x18e9022b user0:0x7099      59.98          1.0          0.0
              4   0.69012345 0x18e9022b 0xfaee0da9 user1:0x3C44      59.98          2.0          0.0
              5   0.69012345 0xfaee0da9 0x00000000 user2:0x90F7      59.98          3.0          0.0
              6       0.6902 0x3c4b04ad 0x9d5648cb user0:0x7099      59.98          1.0          0.0
              7       0.6902 0x9d5648cb 0xd089dc33 user1:0x3C44      59.98          2.0          0.0
              8       0.6902 0xd089dc33 0x00000000 user2:0x90F7      59.98          3.0          0.0

        > user3->dexz.trade(FillAnyAndAddOrder, BUY, token0, WETH, 0.69, expiry, sellBaseTokens, []) - gasUsed: 337664 ~ ETH 0.01350656 ~ USD 27
          + WETH:0x9fE4 38.0 Transfer(from: user3:0x15d3, to: user0:0x7099, tokens: 0.69)
          + Token0:0x5FbD 38.1 Transfer(from: user0:0x7099, to: user3:0x15d3, tokens: 1.0)
          + Dexz:0xCf7E 38.2 Trade(pairKey: 0x4c03...1e77, orderKey: 0x6e3a...42fb, buySell: 0, taker: user3:0x15d3, maker: user0:0x7099, baseTokens: 1.0, quoteTokens: 0.69, price: 0.69)
          + WETH:0x9fE4 38.3 Transfer(from: user3:0x15d3, to: user1:0x3C44, tokens: 1.38)
          + Token0:0x5FbD 38.4 Transfer(from: user1:0x3C44, to: user3:0x15d3, tokens: 2.0)
          + Dexz:0xCf7E 38.5 Trade(pairKey: 0x4c03...1e77, orderKey: 0xe5f3...5b56, buySell: 0, taker: user3:0x15d3, maker: user1:0x3C44, baseTokens: 2.0, quoteTokens: 1.38, price: 0.69)
          + WETH:0x9fE4 38.6 Transfer(from: user3:0x15d3, to: user2:0x90F7, tokens: 2.07)
          + Token0:0x5FbD 38.7 Transfer(from: user2:0x90F7, to: user3:0x15d3, tokens: 3.0)
          + Dexz:0xCf7E 38.8 Trade(pairKey: 0x4c03...1e77, orderKey: 0x9ed6...800a, buySell: 0, taker: user3:0x15d3, maker: user2:0x90F7, baseTokens: 3.0, quoteTokens: 2.07, price: 0.69)
          + Dexz:0xCf7E 38.9 OrderAdded(pairKey: 0x4c03...1e77, key: 0xc4ff...38bd, maker: user3:0x15d3, buySell: 0, price: 0.69, expiry: 1684909718, baseTokens: 63.0)
          + Dexz:0xCf7E 38.10 TradeSummary(buySell: 0, taker: user3:0x15d3, baseTokensFilled: 6.0, quoteTokensFilled: 4.14, price: 0.69, baseTokensOnOrder: 63.0)
          Pair 0x4c038ad6bfca2133ee6f20ac54377d10fb6f3756d2321ead7428e24817161e77 Token0:0x5FbD WETH:0x9fE4 9 0 18 18
 BUY {"price":690000000,"orderKey":"0xc4ffbbb2b6224a1a9038c6f0caf7466bd4d72a4773869ef4cd4ad1b8135538bd","nextOrderKey":"0x0000000000000000000000000000000000000000000000000000000000000000","maker":"0x15d34AAf54267DB7D7c367839AAf71A00a2C6A65","expiry":1684909718,"baseTokens":"63000000000000000000","baseTokensFilled":"0"}
SELL {"price":690123450,"orderKey":"0x45b3664521abacc42046bf49cdc2fb3d228f67a7c3d2862c774d41e091ac0921","nextOrderKey":"0x18e9022b0efbd5fd81ee532c7394832aecd8932cfe11036880c6083ae4039810","maker":"0x70997970C51812dc3A010C7d01b50e0d17dc79C8","expiry":1684909718,"baseTokens":"1000000000000000000","baseTokensFilled":"0"}
SELL {"price":690123450,"orderKey":"0x18e9022b0efbd5fd81ee532c7394832aecd8932cfe11036880c6083ae4039810","nextOrderKey":"0xfaee0da91fef4242da06d47a5fc36cb153ec9e5f8fa06e51cc6d8489c4953357","maker":"0x3C44CdDdB6a900fa2b585dd299e03d12FA4293BC","expiry":1684909718,"baseTokens":"2000000000000000000","baseTokensFilled":"0"}
SELL {"price":690123450,"orderKey":"0xfaee0da91fef4242da06d47a5fc36cb153ec9e5f8fa06e51cc6d8489c4953357","nextOrderKey":"0x0000000000000000000000000000000000000000000000000000000000000000","maker":"0x90F79bf6EB2c4f870365E785982E1f101E93b906","expiry":1684909718,"baseTokens":"3000000000000000000","baseTokensFilled":"0"}
SELL {"price":690200000,"orderKey":"0x3c4b04adee53907bafb804e5d1b97953ce9ce9247755c5085e7f320534e24cd9","nextOrderKey":"0x9d5648cbf78e6523ea2bc6b8066ec19fc7584572de63a113d3083abb5d44f8ee","maker":"0x70997970C51812dc3A010C7d01b50e0d17dc79C8","expiry":1684909718,"baseTokens":"1000000000000000000","baseTokensFilled":"0"}
SELL {"price":690200000,"orderKey":"0x9d5648cbf78e6523ea2bc6b8066ec19fc7584572de63a113d3083abb5d44f8ee","nextOrderKey":"0xd089dc3367448069d04a2453ed1c8714bf0cdec1bd8b41c3b7f8287cc62308dc","maker":"0x3C44CdDdB6a900fa2b585dd299e03d12FA4293BC","expiry":1684909718,"baseTokens":"2000000000000000000","baseTokensFilled":"0"}
SELL {"price":690200000,"orderKey":"0xd089dc3367448069d04a2453ed1c8714bf0cdec1bd8b41c3b7f8287cc62308dc","nextOrderKey":"0x0000000000000000000000000000000000000000000000000000000000000000","maker":"0x90F79bf6EB2c4f870365E785982E1f101E93b906","expiry":1684909718,"baseTokens":"3000000000000000000","baseTokensFilled":"0"}

        --- After Executing Against Order(s) ---
          Account                                   ETH                 TOK0[18]                 TOK1[18]                 WETH[18] Blah
          -------------------- ------------------------ ------------------------ ------------------------ ------------------------ ---------------------------------------------
          deployer:0xf39F       9999.991495909267008439                      0.0                      0.0                      0.0
          user0:0x7099          9899.999118163916093468                     99.0                    100.0                   100.69
          user1:0x3C44          9899.999410947502333529                     98.0                    100.0                   101.38
          user2:0x90F7          9899.999415417042022057                     97.0                    100.0                   102.07
          user3:0x15d3          9899.999467908737505558                    106.0                    100.0                    95.86
          Dexz:0xCf7E                               0.0                      0.0                      0.0                      0.0

          Dexz: Dexz:0xCf7E
          ----- Pair 0x4c038ad6bfca2133ee6f20ac54377d10fb6f3756d2321ead7428e24817161e77 Token0:0x5FbD/WETH:0x9fE4 9 0 -----
              #    BUY Price OrderKey   Next       Maker         Expiry(s)   BaseTokens       Filled
            --- ------------ ---------- ---------- ------------ ---------- ------------ ------------
              0         0.69 0xc4ffbbb2 0x00000000 user3:0x15d3      59.98         63.0          0.0

              #   SELL Price OrderKey   Next       Maker         Expiry(s)   BaseTokens       Filled
            --- ------------ ---------- ---------- ------------ ---------- ------------ ------------
              1   0.69012345 0x45b36645 0x18e9022b user0:0x7099      59.98          1.0          0.0
              2   0.69012345 0x18e9022b 0xfaee0da9 user1:0x3C44      59.98          2.0          0.0
              3   0.69012345 0xfaee0da9 0x00000000 user2:0x90F7      59.98          3.0          0.0
              4       0.6902 0x3c4b04ad 0x9d5648cb user0:0x7099      59.98          1.0          0.0
              5       0.6902 0x9d5648cb 0xd089dc33 user1:0x3C44      59.98          2.0          0.0
              6       0.6902 0xd089dc33 0x00000000 user2:0x90F7      59.98          3.0          0.0

    ✔ 00. Test 00 (325ms)


  1 passing (1s)

