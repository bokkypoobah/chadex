

  Chadex

      beforeEach
        --- Setup Tokens and Chadex Contracts. Assuming gasPrice: 10.0 gwei, ethUsd: 2500.0 ---
      Mapping contract 0x5FbDB2315678afecb367f032d93F642f64180aa3 => Token0:0x5FbD
        Token0 deployed: 0x5FbDB2315678afecb367f032d93F642f64180aa3
      Mapping contract 0xe7f1725E7734CE288F8367e1Bb143E90bb3F0512 => Token1:0xe7f1
        Token1 deployed: 0xe7f1725E7734CE288F8367e1Bb143E90bb3F0512
      Mapping contract 0x9fE46736679d2D9a65F0992F2272dE9f3c7fa6e0 => WETH:0x9fE4
        WETH deployed: 0x9fE46736679d2D9a65F0992F2272dE9f3c7fa6e0
      Mapping contract 0xCf7Ed3AccA5a467e9e704C703E8D87F634fB0Fc9 => Chadex:0xCf7E
        Chadex deployed: 0xCf7Ed3AccA5a467e9e704C703E8D87F634fB0Fc9
        > Transfer Token0 - gasUsed: 51394 ~ ETH 0.00051394 ~ USD 1
          + Token0:0x5FbD Transfer(from: deployer:0xf39F, to: user0:0x7099, tokens: 100.0)
        > Transfer Token0 - gasUsed: 51382 ~ ETH 0.00051382 ~ USD 1
          + Token0:0x5FbD Transfer(from: deployer:0xf39F, to: user1:0x3C44, tokens: 100.0)
        > Transfer Token0 - gasUsed: 51394 ~ ETH 0.00051394 ~ USD 1
          + Token0:0x5FbD Transfer(from: deployer:0xf39F, to: user2:0x90F7, tokens: 100.0)
        > Transfer Token0 - gasUsed: 46594 ~ ETH 0.00046594 ~ USD 1
          + Token0:0x5FbD Transfer(from: deployer:0xf39F, to: user3:0x15d3, tokens: 100.0)
        Tokens transferred
        > Transfer Token1 - gasUsed: 51394 ~ ETH 0.00051394 ~ USD 1
          + Token1:0xe7f1 Transfer(from: deployer:0xf39F, to: user0:0x7099, tokens: 100.0)
        > Transfer Token1 - gasUsed: 51382 ~ ETH 0.00051382 ~ USD 1
          + Token1:0xe7f1 Transfer(from: deployer:0xf39F, to: user1:0x3C44, tokens: 100.0)
        > Transfer Token1 - gasUsed: 51394 ~ ETH 0.00051394 ~ USD 1
          + Token1:0xe7f1 Transfer(from: deployer:0xf39F, to: user2:0x90F7, tokens: 100.0)
        > Transfer Token1 - gasUsed: 46594 ~ ETH 0.00046594 ~ USD 1
          + Token1:0xe7f1 Transfer(from: deployer:0xf39F, to: user3:0x15d3, tokens: 100.0)
        > Send weth - gasUsed: 44784 ~ ETH 0.00044784 ~ USD 1
          + WETH:0x9fE4 Deposit(from: null:0x0000, to: user0:0x7099, tokens: 100.0)
        > Send weth - gasUsed: 44784 ~ ETH 0.00044784 ~ USD 1
          + WETH:0x9fE4 Deposit(from: null:0x0000, to: user1:0x3C44, tokens: 100.0)
        > Send weth - gasUsed: 44784 ~ ETH 0.00044784 ~ USD 1
          + WETH:0x9fE4 Deposit(from: null:0x0000, to: user2:0x90F7, tokens: 100.0)
        > Send weth - gasUsed: 44784 ~ ETH 0.00044784 ~ USD 1
          + WETH:0x9fE4 Deposit(from: null:0x0000, to: user3:0x15d3, tokens: 100.0)
        > user0->token0.approve(chadex, 10.0) - gasUsed: 46151 ~ ETH 0.00046151 ~ USD 1
          + Token0:0x5FbD Approval(owner: user0:0x7099, spender: Chadex:0xCf7E, tokens: 10.0)
        > user0->token1.approve(chadex, 10.0) - gasUsed: 46151 ~ ETH 0.00046151 ~ USD 1
          + Token1:0xe7f1 Approval(owner: user0:0x7099, spender: Chadex:0xCf7E, tokens: 10.0)
        > user0->weth.approve(chadex, 2.69) - gasUsed: 46174 ~ ETH 0.00046174 ~ USD 1
          + WETH:0x9fE4 Approval(owner: user0:0x7099, spender: Chadex:0xCf7E, tokens: 2.69)
        > user1->token0.approve(chadex, 10.0) - gasUsed: 46151 ~ ETH 0.00046151 ~ USD 1
          + Token0:0x5FbD Approval(owner: user1:0x3C44, spender: Chadex:0xCf7E, tokens: 10.0)
        > user1->token1.approve(chadex, 10.0) - gasUsed: 46151 ~ ETH 0.00046151 ~ USD 1
          + Token1:0xe7f1 Approval(owner: user1:0x3C44, spender: Chadex:0xCf7E, tokens: 10.0)
        > user1->weth.approve(chadex, 2.69) - gasUsed: 46174 ~ ETH 0.00046174 ~ USD 1
          + WETH:0x9fE4 Approval(owner: user1:0x3C44, spender: Chadex:0xCf7E, tokens: 2.69)
        > user2->token0.approve(chadex, 10.0) - gasUsed: 46151 ~ ETH 0.00046151 ~ USD 1
          + Token0:0x5FbD Approval(owner: user2:0x90F7, spender: Chadex:0xCf7E, tokens: 10.0)
        > user2->token1.approve(chadex, 10.0) - gasUsed: 46151 ~ ETH 0.00046151 ~ USD 1
          + Token1:0xe7f1 Approval(owner: user2:0x90F7, spender: Chadex:0xCf7E, tokens: 10.0)
        > user2->weth.approve(chadex, 2.69) - gasUsed: 46174 ~ ETH 0.00046174 ~ USD 1
          + WETH:0x9fE4 Approval(owner: user2:0x90F7, spender: Chadex:0xCf7E, tokens: 2.69)
        > user3->token0.approve(chadex, 10.0) - gasUsed: 46151 ~ ETH 0.00046151 ~ USD 1
          + Token0:0x5FbD Approval(owner: user3:0x15d3, spender: Chadex:0xCf7E, tokens: 10.0)
        > user3->token1.approve(chadex, 10.0) - gasUsed: 46151 ~ ETH 0.00046151 ~ USD 1
          + Token1:0xe7f1 Approval(owner: user3:0x15d3, spender: Chadex:0xCf7E, tokens: 10.0)
        > user3->weth.approve(chadex, 2.69) - gasUsed: 46174 ~ ETH 0.00046174 ~ USD 1
          + WETH:0x9fE4 Approval(owner: user3:0x15d3, spender: Chadex:0xCf7E, tokens: 2.69)
      00. Test 00 - Happy Path - Specified Set
        Executing: [
  {
    "action": 2,
    "buySell": 0,
    "tokenz": [
      "0x5FbDB2315678afecb367f032d93F642f64180aa3",
      "0x9fE46736679d2D9a65F0992F2272dE9f3c7fa6e0"
    ],
    "price": "690100000",
    "targetPrice": "690100000",
    "expiry": 1728612815,
    "tokens": "1000000000000000000",
    "skipCheck": false
  },
  {
    "action": 2,
    "buySell": 0,
    "tokenz": [
      "0x5FbDB2315678afecb367f032d93F642f64180aa3",
      "0x9fE46736679d2D9a65F0992F2272dE9f3c7fa6e0"
    ],
    "price": "690200000",
    "targetPrice": "690200000",
    "expiry": 1728612815,
    "tokens": "2000000000000000000",
    "skipCheck": false
  },
  {
    "action": 2,
    "buySell": 0,
    "tokenz": [
      "0x5FbDB2315678afecb367f032d93F642f64180aa3",
      "0x9fE46736679d2D9a65F0992F2272dE9f3c7fa6e0"
    ],
    "price": "690300000",
    "targetPrice": "690300000",
    "expiry": 1728612815,
    "tokens": "3000000000000000000",
    "skipCheck": false
  }
]
        > user0->chadex.execute(actionsA) - gasUsed: 665657 ~ ETH 0.00665657 ~ USD 16
          + Chadex:0xCf7E PairAdded(pairKey: 0x2c831da670a13afa44, maker: user0:0x7099, base: Token0:0x5FbD, quote: WETH:0x9fE4, decimalss: [18,18], timestamp: 1728609243)
          + Chadex:0xCf7E OrderAdded(pairKey: 0x2c831da670a13afa44, orderKey: 0xba50bff8ca4fde4978, maker: user0:0x7099, buySell: 0, price: 0.6901, expiry: 1728612815, baseTokens: 1.0, quoteTokens: 0.6901, timestamp: 1728609243)
          + Chadex:0xCf7E OrderAdded(pairKey: 0x2c831da670a13afa44, orderKey: 0x16ee2eb820c1dc86c5, maker: user0:0x7099, buySell: 0, price: 0.6902, expiry: 1728612815, baseTokens: 2.0, quoteTokens: 1.3804, timestamp: 1728609243)
          + Chadex:0xCf7E OrderAdded(pairKey: 0x2c831da670a13afa44, orderKey: 0x216071ecd309e02f0a, maker: user0:0x7099, buySell: 0, price: 0.6903, expiry: 1728612815, baseTokens: 3.0, quoteTokens: 2.0709, timestamp: 1728609243)
        > user1->chadex.execute(actionsA) - gasUsed: 376296 ~ ETH 0.00376296 ~ USD 9
          + Chadex:0xCf7E OrderAdded(pairKey: 0x2c831da670a13afa44, orderKey: 0x57e1bbde3a5a6e6ba5, maker: user1:0x3C44, buySell: 0, price: 0.6901, expiry: 1728612815, baseTokens: 1.0, quoteTokens: 0.6901, timestamp: 1728609244)
          + Chadex:0xCf7E OrderAdded(pairKey: 0x2c831da670a13afa44, orderKey: 0x4fcf79cf98e01a03f6, maker: user1:0x3C44, buySell: 0, price: 0.6902, expiry: 1728612815, baseTokens: 2.0, quoteTokens: 1.3804, timestamp: 1728609244)
          + Chadex:0xCf7E OrderAdded(pairKey: 0x2c831da670a13afa44, orderKey: 0xc4fd7db027bc75d73f, maker: user1:0x3C44, buySell: 0, price: 0.6903, expiry: 1728612815, baseTokens: 3.0, quoteTokens: 2.0709, timestamp: 1728609244)
        > user2->chadex.execute(actionsA) - gasUsed: 376296 ~ ETH 0.00376296 ~ USD 9
          + Chadex:0xCf7E OrderAdded(pairKey: 0x2c831da670a13afa44, orderKey: 0x452f99950d915502ce, maker: user2:0x90F7, buySell: 0, price: 0.6901, expiry: 1728612815, baseTokens: 1.0, quoteTokens: 0.6901, timestamp: 1728609245)
          + Chadex:0xCf7E OrderAdded(pairKey: 0x2c831da670a13afa44, orderKey: 0xdc9dfdc4362c69200e, maker: user2:0x90F7, buySell: 0, price: 0.6902, expiry: 1728612815, baseTokens: 2.0, quoteTokens: 1.3804, timestamp: 1728609245)
          + Chadex:0xCf7E OrderAdded(pairKey: 0x2c831da670a13afa44, orderKey: 0xe7bb22970ed8b3926f, maker: user2:0x90F7, buySell: 0, price: 0.6903, expiry: 1728612815, baseTokens: 3.0, quoteTokens: 2.0709, timestamp: 1728609245)

        --- After Adding Orders ---
          Account                                   ETH                 TOK0[18]                 TOK1[18]                 WETH[18] Blah
          -------------------- ------------------------ ------------------------ ------------------------ ------------------------ ---------------------------------------------
          deployer:0xf39F       9999.988181440316473361                      0.0                      0.0                      0.0
          user0:0x7099          9899.999114192188709382                    100.0                    100.0                    100.0
          user1:0x3C44          9899.999416552681207036                    100.0                    100.0                    100.0
          user2:0x90F7          9899.999421363384773366                    100.0                    100.0                    100.0
          user3:0x15d3          9899.999806994510806249                    100.0                    100.0                    100.0
          Chadex:0xCf7E                             0.0                      0.0                      0.0                      0.0

          Chadex: Chadex:0xCf7E
          ----- Pair 0x2c831da670a13afa44000f723f930fbd31948192e5612f758ae2cfaeee460dc2 Token0:0x5FbD/WETH:0x9fE4 18 18 -----
              #      BUY Price OrderKey   Next       Maker         Expiry(s)                Tokens     Total Available Base    Total Available Quote
            --- -------------- ---------- ---------- ------------ ---------- --------------------- ------------------------ ------------------------
              0         0.6903 0x216071ec 0xc4fd7db0 user0:0x7099      60.00                   3.0     3.896856439229320585                     2.69
              1         0.6903 0xc4fd7db0 0xe7bb2297 user1:0x3C44      60.00                   3.0     3.896856439229320585                     2.69
              2         0.6903 0xe7bb2297 0x00000000 user2:0x90F7      60.00                   3.0     3.896856439229320585                     2.69
              3         0.6902 0x16ee2eb8 0x4fcf79cf user0:0x7099      60.00                   2.0     3.897421037380469429                     2.69
              4         0.6902 0x4fcf79cf 0xdc9dfdc4 user1:0x3C44      60.00                   2.0     3.897421037380469429                     2.69
              5         0.6902 0xdc9dfdc4 0x00000000 user2:0x90F7      60.00                   2.0     3.897421037380469429                     2.69
              6         0.6901 0xba50bff8 0x57e1bbde user0:0x7099      60.00                   1.0     3.897985799159542095                     2.69
              7         0.6901 0x57e1bbde 0x452f9995 user1:0x3C44      60.00                   1.0     3.897985799159542095                     2.69
              8         0.6901 0x452f9995 0x00000000 user2:0x90F7      60.00                   1.0     3.897985799159542095                     2.69

            price: 0.6903 head=0x216071ec tail=0xe7bb2297
              Order key=0x216071ec next=0xc4fd7db0 maker=user0:0x7099 expiry=60.00s tokens=3.0
              Order key=0xc4fd7db0 next=0xe7bb2297 maker=user1:0x3C44 expiry=60.00s tokens=3.0
              Order key=0xe7bb2297 next=0x00000000 maker=user2:0x90F7 expiry=60.00s tokens=3.0
            price: 0.6902 head=0x16ee2eb8 tail=0xdc9dfdc4
              Order key=0x16ee2eb8 next=0x4fcf79cf maker=user0:0x7099 expiry=60.00s tokens=2.0
              Order key=0x4fcf79cf next=0xdc9dfdc4 maker=user1:0x3C44 expiry=60.00s tokens=2.0
              Order key=0xdc9dfdc4 next=0x00000000 maker=user2:0x90F7 expiry=60.00s tokens=2.0
            price: 0.6901 head=0xba50bff8 tail=0x452f9995
              Order key=0xba50bff8 next=0x57e1bbde maker=user0:0x7099 expiry=60.00s tokens=1.0
              Order key=0x57e1bbde next=0x452f9995 maker=user1:0x3C44 expiry=60.00s tokens=1.0
              Order key=0x452f9995 next=0x00000000 maker=user2:0x90F7 expiry=60.00s tokens=1.0

              #     SELL Price OrderKey   Next       Maker         Expiry(s)                Tokens     Total Available Base    Total Available Quote
            --- -------------- ---------- ---------- ------------ ---------- --------------------- ------------------------ ------------------------



            pairKey: 0x2c831da670a13afa44000f723f930fbd31948192e5612f758ae2cfaeee460dc2, tokenz=["0x5FbDB2315678afecb367f032d93F642f64180aa3","0x9fE46736679d2D9a65F0992F2272dE9f3c7fa6e0"], decimalss=[18,18], bestBuyOrder=["690300000","0x216071ecd309e02f0a7c41a681f63c840beb698b2aedb288198fa4cb3667138e","0xc4fd7db027bc75d73f894dcf8f248f903df706acd79ab89dd74e57ca3c14a360","0x70997970C51812dc3A010C7d01b50e0d17dc79C8","1728612815","3000000000000000000","3896856439229320585","2690000000000000000"], bestSellOrder=["0","0x0000000000000000000000000000000000000000000000000000000000000000","0x0000000000000000000000000000000000000000000000000000000000000000","0x0000000000000000000000000000000000000000","0","0","0","0"]

        Executing: [
  {
    "action": 2,
    "buySell": 1,
    "tokenz": [
      "0x5FbDB2315678afecb367f032d93F642f64180aa3",
      "0x9fE46736679d2D9a65F0992F2272dE9f3c7fa6e0"
    ],
    "price": "690100000",
    "targetPrice": "690100000",
    "expiry": 1728612815,
    "tokens": "10000000000000000000",
    "skipCheck": false
  }
]
        > user3->chadex.execute(actions) - gasUsed: 314227 ~ ETH 0.00314227 ~ USD 7
          + Token0:0x5FbD Transfer(from: user3:0x15d3, to: user0:0x7099, tokens: 3.0)
          + WETH:0x9fE4 Transfer(from: user0:0x7099, to: user3:0x15d3, tokens: 2.0709)
          + Chadex:0xCf7E Trade(pairKey: 0x2c831da670a13afa44, orderKey: 0x216071ecd309e02f0a, taker: user3:0x15d3, maker: user0:0x7099, buySell: 1, price: 0.6903, baseTokens: 3.0, quoteTokens: 2.0709, timestamp: 1728609246)
          + Token0:0x5FbD Transfer(from: user3:0x15d3, to: user1:0x3C44, tokens: 3.0)
          + WETH:0x9fE4 Transfer(from: user1:0x3C44, to: user3:0x15d3, tokens: 2.0709)
          + Chadex:0xCf7E Trade(pairKey: 0x2c831da670a13afa44, orderKey: 0xc4fd7db027bc75d73f, taker: user3:0x15d3, maker: user1:0x3C44, buySell: 1, price: 0.6903, baseTokens: 3.0, quoteTokens: 2.0709, timestamp: 1728609246)
          + Token0:0x5FbD Transfer(from: user3:0x15d3, to: user2:0x90F7, tokens: 3.0)
          + WETH:0x9fE4 Transfer(from: user2:0x90F7, to: user3:0x15d3, tokens: 2.0709)
          + Chadex:0xCf7E Trade(pairKey: 0x2c831da670a13afa44, orderKey: 0xe7bb22970ed8b3926f, taker: user3:0x15d3, maker: user2:0x90F7, buySell: 1, price: 0.6903, baseTokens: 3.0, quoteTokens: 2.0709, timestamp: 1728609246)
          + Token0:0x5FbD Transfer(from: user3:0x15d3, to: user0:0x7099, tokens: 0.896986380759200231)
          + WETH:0x9fE4 Transfer(from: user0:0x7099, to: user3:0x15d3, tokens: 0.6191)
          + Chadex:0xCf7E Trade(pairKey: 0x2c831da670a13afa44, orderKey: 0x16ee2eb820c1dc86c5, taker: user3:0x15d3, maker: user0:0x7099, buySell: 1, price: 0.6902, baseTokens: 0.896986380759200231, quoteTokens: 0.6191, timestamp: 1728609246)
          + Token0:0x5FbD Transfer(from: user3:0x15d3, to: user1:0x3C44, tokens: 0.103013619240799769)
          + WETH:0x9fE4 Transfer(from: user1:0x3C44, to: user3:0x15d3, tokens: 0.0711)
          + Chadex:0xCf7E Trade(pairKey: 0x2c831da670a13afa44, orderKey: 0x4fcf79cf98e01a03f6, taker: user3:0x15d3, maker: user1:0x3C44, buySell: 1, price: 0.6902, baseTokens: 0.103013619240799769, quoteTokens: 0.0711, timestamp: 1728609246)
          + Chadex:0xCf7E TradeSummary(pairKey: 0x2c831da670a13afa44, taker: user3:0x15d3, buySell: 1, price: 0.69029, baseTokens: 10.0, quoteTokens: 6.9029, tokensOnOrder: 0.0, timestamp: 1728609246)

        --- After Executing Against Orders ---
          Account                                   ETH                 TOK0[18]                 TOK1[18]                 WETH[18] Blah
          -------------------- ------------------------ ------------------------ ------------------------ ------------------------ ---------------------------------------------
          deployer:0xf39F       9999.988181440316473361                      0.0                      0.0                      0.0
          user0:0x7099          9899.999114192188709382   103.896986380759200231                    100.0                    97.31
          user1:0x3C44          9899.999416552681207036   103.103013619240799769                    100.0                   97.858
          user2:0x90F7          9899.999421363384773366                    103.0                    100.0                  97.9291
          user3:0x15d3          9899.999487981236564949                     90.0                    100.0                 106.9029
          Chadex:0xCf7E                             0.0                      0.0                      0.0                      0.0

          Chadex: Chadex:0xCf7E
          ----- Pair 0x2c831da670a13afa44000f723f930fbd31948192e5612f758ae2cfaeee460dc2 Token0:0x5FbD/WETH:0x9fE4 18 18 -----
              #      BUY Price OrderKey   Next       Maker         Expiry(s)                Tokens     Total Available Base    Total Available Quote
            --- -------------- ---------- ---------- ------------ ---------- --------------------- ------------------------ ------------------------
              0         0.6902 0x4fcf79cf 0xdc9dfdc4 user1:0x3C44      60.00  1.896986380759200231     0.793972761518400463                    0.548
              1         0.6902 0xdc9dfdc4 0x00000000 user2:0x90F7      60.00                   2.0     0.896986380759200231                   0.6191
              2         0.6901 0xba50bff8 0x57e1bbde user0:0x7099      60.00                   1.0                      0.0                      0.0
              3         0.6901 0x57e1bbde 0x452f9995 user1:0x3C44      60.00                   1.0     0.794087813360382553                    0.548
              4         0.6901 0x452f9995 0x00000000 user2:0x90F7      60.00                   1.0     0.897116359947833647                   0.6191

            price: 0.6902 head=0x4fcf79cf tail=0xdc9dfdc4
              Order key=0x4fcf79cf next=0xdc9dfdc4 maker=user1:0x3C44 expiry=60.00s tokens=1.896986380759200231
              Order key=0xdc9dfdc4 next=0x00000000 maker=user2:0x90F7 expiry=60.00s tokens=2.0
            price: 0.6901 head=0xba50bff8 tail=0x452f9995
              Order key=0xba50bff8 next=0x57e1bbde maker=user0:0x7099 expiry=60.00s tokens=1.0
              Order key=0x57e1bbde next=0x452f9995 maker=user1:0x3C44 expiry=60.00s tokens=1.0
              Order key=0x452f9995 next=0x00000000 maker=user2:0x90F7 expiry=60.00s tokens=1.0

              #     SELL Price OrderKey   Next       Maker         Expiry(s)                Tokens     Total Available Base    Total Available Quote
            --- -------------- ---------- ---------- ------------ ---------- --------------------- ------------------------ ------------------------



            pairKey: 0x2c831da670a13afa44000f723f930fbd31948192e5612f758ae2cfaeee460dc2, tokenz=["0x5FbDB2315678afecb367f032d93F642f64180aa3","0x9fE46736679d2D9a65F0992F2272dE9f3c7fa6e0"], decimalss=[18,18], bestBuyOrder=["690200000","0x4fcf79cf98e01a03f641e90081ae6c9f2f25715e7200410f5e6faf60d2968aec","0xdc9dfdc4362c69200ed3447b7901034ef868941b0169e3e83d49f52053e39c49","0x3C44CdDdB6a900fa2b585dd299e03d12FA4293BC","1728612815","1896986380759200231","793972761518400463","548000000000000000"], bestSellOrder=["0","0x0000000000000000000000000000000000000000000000000000000000000000","0x0000000000000000000000000000000000000000000000000000000000000000","0x0000000000000000000000000000000000000000","0","0","0","0"]

tokenBalanceAndAllowance: [
  "10000000000000000000,103896986380759200231"
]

    ✔ 00. Test 00 (73ms)


  1 passing (680ms)

